<!doctype htmyear)
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>Recomendaciones de rendimiento para Python</title>

  <link rel="stylesheet" href="dist/reset.css">
  <link rel="stylesheet" href="dist/reveal.css">
  <link rel="stylesheet" href="css/self-theme.css" id="theme">
  <link rel="stylesheet" href="css/self.css" id="theme">
  <link rel="stylesheet" href="css/extras.css">

  <!-- Theme used for syntax highlighted code -->
  <link rel="stylesheet" href="plugin/highlight/monokai.css">

  <!-- Printing and PDF exports -->
  <script>
  if( window.location.search.match( /print-pdf/gi ) ) {
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = 'css/print/pdf.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  }
  </script>
</head>
<body>
  <div class="reveal">
    <div class="slides">
      <!--***************************************************************************-->
      <section data-background-image="img/cover.png">
        <div id="left70">
          <h2 style="font-size: 1.1em;">¬øPor qu√© <strike style="text-decoration-thickness: 6px;"><i class="ep-red">Python</i></strike> <i class="yellow">tu c√≥digo</i> es lento?</h2>
          <h4 style="font-size: 80%;"><i class="blue">recomendaciones para mejorar el rendimiento</i></h4>
        <p style="font-size: 70%;margin-top: 10%;">
          Dr. <i class="yellow">Cristi√°n</i> Maureira-Fredes
        </p>
        <p style="font-size: 50%">
          Senior R&amp;D Manager en  <img class="plain" src="img/qt.png" style="height: 50px; vertical-align: middle; background: rgba(0, 0, 0, 0);">
          <br/>
          @cmaureir<br/>
          <img class="plain" src="img/mastodon.png" style="background: rgba(0,0,0,0);height: 40px;">
          <img class="plain" src="img/github_white.png"  style="background: rgba(0,0,0,0);height: 40px;">
          <img class="plain" src="img/linkedin.png"  style="background: rgba(0,0,0,0);height: 40px;">
          <img class="plain" src="img/twitter.png" style="background: rgba(0,0,0,0);height: 40px;"><br/>
        </p>
        </div>
        <div id="right30">
        </div>
      </section>
      <!--***************************************************************************-->

      <section data-transition="slide-in fade-out">
        <h3><i class="red">¬°Python es lento!</i></h3>
        <h2 class="fragment">¬øQu√© Python? üëÄ</h2>
        <h1 class="fragment">üò®</h1>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>¬øPython?</h3>
        <img style="width: 90%;" src="img/interpreters1.png" />
      </section>

      <section data-transition="fade-in slide-out">
        <h3>¬øPython?</h3>
        <img style="width: 90%;" src="img/interpreters2.png" />
      </section>

      <section data-transition="slide-in fade-out">
        Python es un <i class="yellow">lenguaje de programaci√≥n</i>, que tiene
        muchas implementaciones con distintos <i class="red">runtime</i>.
        <h2>üêç</h2>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><i class="yellow">...por otro lado</i></h3>

        <h4 class="fragment">
          Python ha demostrado ser un lenguaje que permite <i class="green">escalar</i> sistemas
        muy complejos, por ejemplo:
        </h4>

        <p style="font-size: 80%;" class="fragment">
          <i class="orange">YouTube, Dropbox, Disqus, Eventbrite, Reddit, Twilio, Instagram, Yelp, PayPal, etc...</i>
        </p>
      </section>

      <section data-transition="slide-in fade-out">
        <blockquote>
        ...bueno pero igual me dicen que es m√°s lento
        que <i class="ep-red">Lenguaje X</i>
        </blockquote>
        <h3>üòë</h3>
      </section>

      <section data-transition="slide-in fade-out">
        <ul>
          <li class="fragment">el desempe√±o depende de <i class="yellow">tu aplicaci√≥n</i></li>
          <li class="fragment">es posible que <i class="yellow">t√∫ c√≥digo</i> tenga <i class="red">la culpa</i></li>
        </ul>
        <img class="fragment" src="img/pikachu.png" style="width: 40%;"/>
      </section>


      <section data-transition="slide-in fade-out">
        <h3>Peras y Manzanas</h3>
        <img src="img/lenguajes.png" />
      </section>

      <section data-transition="slide-in fade-out">
        <i class="yellow">...entonces</i>
        <h3>¬øc√≥mo puedo mejorar el rendimiento?</h3>
        <h2>ü§î</h2>
      </section>

      <section data-transition="slide-in fade-out" data-background-video="img/matrix.mp4" data-background-video-loop>
        <h1>Programar en Assembly</h1>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><i class="yellow">Rendimiento</i></h3>
        <ul>
          <li class="fragment">üïí Tiempo de ejecuci√≥n</li>
          <li class="fragment">üó† Uso de recursos (memoria)</li>
          <li class="fragment">üñß Transmisi√≥n de datos</li>
          <li class="fragment">...</li>
          <li class="fragment">üßë‚Äçüíª tiempo para escribir c√≥digo</li>
        </ul>
      </section>

      <section data-transition="slide-in fade-out">
        <div id="left">
        C++<br/>
          <pre style="font-size: 20%;"><code class="c++" data-trim data-noescape>
            #ifndef MAINWINDOW_H
            #define MAINWINDOW_H

            #include &lt;QMainWindow&gt;
            #include &lt;QPushButton&gt;

            class MainWindow : public QMainWindow
            {
                Q_OBJECT
                public:
                    MainWindow(QWidget *parent = nullptr);
                private slots:
                    void handleButton();
                private:
                    QPushButton *m_button;
            };

            #endif // MAINWINDOW_H</code></pre>
          <pre style="font-size: 20%;"><code class="c++" data-trim data-noescape>
            #include "mainwindow.h"

            MainWindow::MainWindow(QWidget *parent)
               : QMainWindow(parent)
            {
                m_button = new QPushButton("My Button", this);
                connect(m_button, SIGNAL(clicked()), this, SLOT(handleButton()));
            }

            void MainWindow::handleButton()
            {
                m_button->setText("Ready");
            }</code></pre>
          <pre style="font-size: 20%;"><code class="c++" data-trim data-noescape>
            #include &lt;QApplication&gt;
            #include "mainwindow.h"

            int main(int argc, char *argv[])
            {
                QApplication app(argc, argv);
                MainWindow mainWindow;
                mainWindow.show();
                return app.exec(d);
            }</code></pre>
        </div>
        <div id="rightl">
        Python<br/>
          <pre style="font-size: 20%;"><code class="python" data-trim data-noescape>
            import sys
            from pyside6.QtWidgets import QApplication, QMainWindow, QPushButton

            class MainWindow(QMainWindow):
                def __init__(self, parent=None):
                    QMainWindow.__init__(self, parent)
                    self.button = QPushButton("My Button", self)
                    self.button.clicked.connect(self.handleButton)

                def handleButton(self):
                    self.button.setText("Ready")

            if __name__ == "__main__":
                app = QApplication(sys.argv)
                mainWindow = MainWindow()
                mainWindow.show()
                sys.exit(app.exec())</code></pre>
        </div>
      </section>

      <section data-transition="slide-in fade-out" data-background-color="rgb(52,103,146)">
        <h1>Midiendo el <i class="yellow">tiempo</i></h1>
      </section>

      <section data-transition="slide-in">
        <img src="img/time_time.png"/>
      </section>

      <section data-transition="fade-out">
        <img src="img/time_time2.png"/>
      </section>

      <section data-transition="slide-in fade-out">
        <pre style="font-size: 100%;"><code class="python" data-trim data-noescape>
          import time
          print(time.time() - time.time())
        </code></pre>
        ¬ø?
      </section>

      <section data-transition="slide-in fade-out">
        <img src="img/time_perf_counter.png"/>
      </section>

      <section data-transition="slide-in fade-out">
        <div id="left">
        <pre style="font-size: 45%;"><code class="python" data-trim data-noescape>
        import time

        def f(lst, v):
            total = 0
            t1 = time.time()
            for i in lst:
                total += i ** v
            t2 = time.time()
            return total, t2-t1

        def g(lst, v):
            total = 0
            t1 = time.perf_counter_ns()
            for i in lst:
                total += i ** v
            t2 = time.perf_counter_ns()
            return total, (t2-t1)/(10**9)
        </code></pre>
        </div>
        <div id="right">
        <pre style="font-size: 35%;"><code class="python fragment" data-trim data-noescape>
        print("Using time.time()")
        print(f([1,2], 1))
        print(f(range(10), 2))
        print(f(range(100), 3))
        print(f(range(10_000), 2))

        print("Using time.perf_counter_ns()")
        print(g([1,2], 1))
        print(g(range(10), 2))
        print(g(range(100), 3))
        print(g(range(10_000), 2))
        </code></pre>
        <pre style="font-size: 45%;"><code class="python fragment" data-trim data-noescape>
        # Using time.time()
        (1, 4.76837158203125e-07)
        (3, 4.76837158203125e-07)
        (285, 2.384185791015625e-06)
        (24502500, 2.2649765014648438e-05)
        (333283335000, 0.001733541488647461)

        # Using time.perf_counter_ns()
        (1, 5e-07)
        (3, 5.5e-07)
        (285, 1.96e-06)
        (24502500, 1.717e-05)
        (333283335000, 0.001738651)
        </code></pre>
        </div>
      </section>

      <section data-transition="slide-in fade-out" data-background-color="rgb(52,103,146)">
        <h1>Perfilando</h1>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><code>cProfile</code></h3>
        <pre style="font-size: 90%; width: 80%;"><code class="bash" data-trim data-noescape>
        python -m cProfile main.py
        </code></pre>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><code>cProfile</code> (1/2)</h3>
        <pre style="font-size: 40%; width: 80%;"><code class="python" data-trim data-noescape>
        import random

        def f(lst):
            t = 0
            for i in lst:
                for j in i:
                    t += j
            return t

        def g(lst):
            t = 0
            for i in lst:
                t += sum(i)
            return t

        N = 5_000
        l =  [[random.random() for i in range(N) for _ in range(N)]]
        print(f(l))
        print(g(l))
        </code></pre>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><code>cProfile</code> (2/2)</h3>
        <pre style="font-size: 40%; width: 100%;"><code class="bash" data-trim data-noescape>
25001425 function calls (25001398 primitive calls) in 3.828 seconds

   Ordered by: cumulative time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
      3/1    0.000    0.000    3.828    3.828 {built-in method builtins.exec}
        1    0.000    0.000    3.827    3.827 perfil.py:1(<module>)
        1    2.196    2.196    3.149    3.149 perfil.py:18(<listcomp>)
 25000000    0.953    0.000    0.953    0.000 {method 'random' of '_random.Random' objects}
        1    0.596    0.596    0.596    0.596 perfil.py:3(f)
        1    0.000    0.000    0.082    0.082 perfil.py:10(g)
        1    0.082    0.082    0.082    0.082 {built-in method builtins.sum}
      6/1    0.000    0.000    0.001    0.001 <frozen importlib._bootstrap>:1022(_find_and_load)
      6/1    0.000    0.000    0.001    0.001 <frozen importlib._bootstrap>:987(_find_and_load_unlocked)
      6/1    0.000    0.000    0.001    0.001 <frozen importlib._bootstrap>:664(_load_unlocked)
      2/1    0.000    0.000    0.001    0.001 <frozen importlib._bootstrap_external>:877(exec_module)
     10/1    0.000    0.000    0.001    0.001 <frozen importlib._bootstrap>:233(_call_with_frames_removed)
        1    0.000    0.000    0.001    0.001 random.py:1(<module>)
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:921(_find_spec)
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:1431(find_spec)
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:1399(_get_spec)
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:564(module_from_spec)
       22    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:1536(find_spec)
        4    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:1174(create_module)
        4    0.000    0.000    0.000    0.000 {built-in method _imp.create_dynamic}
        1    0.000    0.000    0.000    0.000 bisect.py:1(<module>)
        2    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:950(get_code)
       96    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:126(_path_join)
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:492(_init_module_attrs)
        2    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:670(_compile_bytecode)
        2    0.000    0.000    0.000    0.000 {built-in method builtins.print}
        2    0.000    0.000    0.000    0.000 {built-in method marshal.loads}
        4    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:1070(get_data)
       96    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:128(<listcomp>)
       30    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:140(_path_stat)
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:198(cb)
       30    0.000    0.000    0.000    0.000 {built-in method posix.stat}
       12    0.000    0.000    0.000    0.000 {method 'get' of 'dict' objects}
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:169(__enter__)
        8    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:391(cached)
        4    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:380(cache_from_source)
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:510(_get_cached)
        2    0.000    0.000    0.000    0.000 {built-in method builtins.__build_class__}
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:1531(_get_spec)
        4    0.000    0.000    0.000    0.000 {built-in method io.open_code}
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:179(_get_module_lock)
       42    0.000    0.000    0.000    0.000 {built-in method builtins.getattr}
        6    0.000    0.000    0.000    0.000 __init__.py:89(find_spec)
      110    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:244(_verbose_message)
        4    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:1182(exec_module)
       28    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:1356(_path_importer_cache)
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:721(spec_from_file_location)
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:159(_path_isfile)
        4    0.000    0.000    0.000    0.000 {method 'read' of '_io.BufferedReader' objects}
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:150(_path_is_mode_type)
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:100(acquire)
        4    0.000    0.000    0.000    0.000 {built-in method _imp.exec_dynamic}
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:173(__exit__)
      196    0.000    0.000    0.000    0.000 {method 'rstrip' of 'str' objects}
        1    0.000    0.000    0.000    0.000 random.py:119(__init__)
        1    0.000    0.000    0.000    0.000 random.py:128(seed)
      100    0.000    0.000    0.000    0.000 {method 'join' of 'str' objects}
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:125(release)
        2    0.000    0.000    0.000    0.000 {built-in method _imp.source_hash}
        4    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:132(_path_split)
       24    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:897(__exit__)
        1    0.000    0.000    0.000    0.000 {function Random.seed at 0x7fa9576d9d80}
       24    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:893(__enter__)
        6    0.000    0.000    0.000    0.000 {built-in method posix.getcwd}
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:71(__init__)
        2    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:585(_classify_pyc)
        4    0.000    0.000    0.000    0.000 {method '__exit__' of '_io._IOBase' objects}
        4    0.000    0.000    0.000    0.000 {built-in method builtins.max}
        1    0.000    0.000    0.000    0.000 random.py:103(Random)
       35    0.000    0.000    0.000    0.000 {built-in method builtins.hasattr}
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:746(find_spec)
        6    0.000    0.000    0.000    0.000 {method 'format' of 'str' objects}
       38    0.000    0.000    0.000    0.000 {method 'rpartition' of 'str' objects}
        6    0.000    0.000    0.000    0.000 {built-in method builtins.locals}
        2    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:1089(path_stats)
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:404(parent)
       36    0.000    0.000    0.000    0.000 {built-in method builtins.isinstance}
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:180(_path_isabs)
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:357(__init__)
       36    0.000    0.000    0.000    0.000 {built-in method _imp.acquire_lock}
       36    0.000    0.000    0.000    0.000 {built-in method _imp.release_lock}
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:826(find_spec)
       10    0.000    0.000    0.000    0.000 {method 'endswith' of 'str' objects}
        8    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:134(<genexpr>)
        1    0.000    0.000    0.000    0.000 {built-in method math.exp}
        2    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:84(_unpack_uint32)
       22    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:71(_relax_case)
        6    0.000    0.000    0.000    0.000 {built-in method _imp.is_builtin}
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:165(__init__)
        2    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:542(_check_name_wrapper)
       12    0.000    0.000    0.000    0.000 {built-in method _thread.allocate_lock}
       12    0.000    0.000    0.000    0.000 {method '__exit__' of '_thread.lock' objects}
        6    0.000    0.000    0.000    0.000 {method 'startswith' of 'str' objects}
        1    0.000    0.000    0.000    0.000 random.py:219(__init_subclass__)
       12    0.000    0.000    0.000    0.000 {built-in method _thread.get_ident}
        4    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:1163(__init__)
        2    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:48(_new_module)
        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}
        6    0.000    0.000    0.000    0.000 {built-in method _imp.is_frozen}
        6    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap>:412(has_location)
       10    0.000    0.000    0.000    0.000 {built-in method posix.fspath}
        6    0.000    0.000    0.000    0.000 {method 'pop' of 'dict' objects}
        1    0.000    0.000    0.000    0.000 {built-in method posix.register_at_fork}
        1    0.000    0.000    0.000    0.000 random.py:813(SystemRandom)
        2    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:646(_validate_hash_pyc)
        4    0.000    0.000    0.000    0.000 {method 'rfind' of 'str' objects}
        2    0.000    0.000    0.000    0.000 {built-in method math.log}
        6    0.000    0.000    0.000    0.000 __init__.py:96(<lambda>)
        2    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:1040(__init__)
        4    0.000    0.000    0.000    0.000 {built-in method builtins.len}
        2    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:1065(get_filename)
        2    0.000    0.000    0.000    0.000 {built-in method from_bytes}
        2    0.000    0.000    0.000    0.000 {built-in method _imp._fix_co_filename}
        2    0.000    0.000    0.000    0.000 <frozen importlib._bootstrap_external>:874(create_module)
        1    0.000    0.000    0.000    0.000 {built-in method math.sqrt}
        </code></pre>
      </section>

      <section data-transition="slide-in fade-out">
        <h1>¬°Hay m√°s opciones!</h1>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>Detalles de perfiladores</h3>
        <ul style="font-size: 80%;">
          <li class="fragment">¬øL√≠neas o Funciones?</li>
          <li class="fragment">¬ø<i>Sampling</i> o <i>Tracing</i>?</li>
          <li class="fragment">¬øSe debe modificar el c√≥digo?</li>
          <li class="fragment">¬øSuporte de hilos?</li>
          <li class="fragment">¬øMulti-processing?</li>
          <li class="fragment">¬øtiempo en C?</li>
          <li class="fragment">leaks, copy, memory, ...</li>
          <li class="fragment">...GPU?</li>
        </ul>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><code>pip install pyinstrument</code></h3>
        <div id="left">
        <pre style="font-size: 40%; width: 80%;"><code class="python" data-trim data-noescape>
        from pyinstrument import Profiler

        profiler = Profiler()
        profiler.start()

        # code you want to profile

        profiler.stop()

        profiler.print()
        </code></pre>
        </div>
        <div id="right">
          <ul>
            <li>Python 3.7+</li>
            <li>sampling / functions</li>
            <li>Compatible con Jupyter, Django, Flask, FastAPI, Pytest</li>
          </ul>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><code>pip install py-spy</code></h3>
        <div id="left">
        <pre style="font-size: 40%; width: 100%;"><code class="python" data-trim data-noescape>
        py-spy record -o profile.svg --pid 12345
        # OR
        py-spy record -o profile.svg -- python main.py
        </code></pre>
        <pre style="font-size: 40%; width: 100%;"><code class="python" data-trim data-noescape>
        py-spy top --pid 12345
        # OR
        py-spy top -- python main.py
        </code></pre>
        <pre style="font-size: 40%; width: 100%;"><code class="python" data-trim data-noescape>
        py-spy dump --pid 12345
        </code></pre>
        </div>
        <div id="right">
          <ul>
            <li>Python 2.3, 2.7, 3.3+</li>
            <li>sampling / lines</li>
            <li>permite visualizaci√≥n</li>
          </ul>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><code>pip install yappi</code></h3>
        <div id="left">
        <pre style="font-size: 40%; width: 100%;"><code class="python" data-trim data-noescape>
        import yappi

        def a():
            for _ in range(10000000):  # do something CPU heavy
                pass

        yappi.set_clock_type("cpu") # Use set_clock_type("wall") for wall time
        yappi.start()
        a()

        yappi.get_func_stats().print_all()
        yappi.get_thread_stats().print_all()
        </code></pre>
        </div>
        <div id="right">
          <ul>
            <li>Python 2.3, 2.7, 3.3+</li>
            <li>tracing / functions</li>
          </ul>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><code>austin</code></h3>
        <div id="left">
        <pre style="font-size: 40%; width: 100%;"><code class="python" data-trim data-noescape>
        austin python main.py
        </code></pre>
        <pre style="font-size: 40%; width: 100%;"><code class="python" data-trim data-noescape>
        austin -p 123
        </code></pre>
        </div>
        <div id="right">
          <ul>
            <li>CPython</li>
            <li>sampler / lines</li>
            <li>Visualizaci√≥n</li>
          </ul>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><code>pip install line_profiler</code></h3>
        <div id="left">
        <pre style="font-size: 40%; width: 100%;"><code class="python" data-trim data-noescape>
        kernprof -l main.py
        </code></pre>
        <pre style="font-size: 40%; width: 100%;"><code class="python" data-trim data-noescape>
        python -m line_profile main.py.lprof
        </code></pre>
        </div>
        <div id="right">
          <ul>
            <li>Python 3.6+</li>
            <li>tracing / lines</li>
            <li>Motivaci√≥n con extensiones</li>
          </ul>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><code>pip install scalene</code> (1/4)</h3>
        <ul>
          <li>CPU + GPU</li>
          <li>Sugerencias IA</li>
          <li>Compatible con Jupyter</li>
          <li>...</li>
        </ul>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><code>pip install scalene</code> (2/4)</h3>
        <img src="img/sample-profile-pystone.png"/>
        <p style="font-size: 60%;">(de <a href="https://github.com/plasma-umass/scalene">github.com/plasma-umass/scalene</a>)
      </section>

      <section data-transition="slide-in fade-out">
        <h3><code>pip install scalene</code> (3/4)</h3>
        <img src="img/profiler-comparison.png"/>
        <p style="font-size: 60%;">(de <a href="https://github.com/plasma-umass/scalene">github.com/plasma-umass/scalene</a>)
      </section>

      <section data-transition="slide-in fade-out">
        <h3><code>pip install scalene</code> (4/4)</h3>
        <img src="img/cpu-accuracy-comparison.png"/>
        <p style="font-size: 60%;">(de <a href="https://github.com/plasma-umass/scalene">github.com/plasma-umass/scalene</a>)
      </section>

      <section data-transition="slide-in fade-out" data-background-color="rgb(52,103,146)">
        <h1>Detalles de implementaci√≥n</i></h1>
      </section>

      <section data-transition="slide-in fade-out">
        <img src="img/mariposa.png"/>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>Reducir el n√∫mero de variables</h3>
      </section>

      <section data-transition="slide-in fade-out">
        <h3><i>Casting</i> innecesarios</h3>
        <div id="left">
          <p style="font-size: 80%;"><i class="yellow">Copiando un <code>str</code></i></p>
          <pre style="font-size: 40%; width: 90%;"><code class="python" data-trim data-noescape>
          # Llamemos todo esto "test_code"
          import random
          import string
          t = random.choices(string.ascii_letters,
                             k=1_000)
          </code></pre>
          <pre style="font-size: 40%; width: 90%;"><code class="python fragment" data-trim data-noescape>
          s = t[:]    # ?
          s = t       # ?
          s = str(t)  # ?
          </code></pre>
        </div>
        <div id="right">
        <pre style="font-size: 35%; width: 90%;"><code class="python fragment" data-trim data-noescape>
        >>> timeit.timeit("s = t[:]", setup=test_code)
        0.9558109600038733
        >>> timeit.timeit("s = t", setup=test_code)
        0.010780797019833699
        >>> timeit.timeit("s = str(t)", setup=test_code)
        23.832692831987515
        </code></pre>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>¬øB√∫cles o <i>Comprehensions</i>? (1/2)</h3>
        <div id="left">
        <pre style="font-size: 40%; width: 90%;"><code class="python" data-trim data-noescape>
        def f(years):
          leaps = []
          for year in years:
              if is_leap(year)
                leaps.append(year)
          return leaps

        def g(years):
          return [year
            for year in years if is_leap(year)]
        </code></pre>
        </div>
        <div id="right">
          <pre style="font-size: 40%; width: 100%;"><code class="python fragment" data-trim data-noescape>
          loop          0.916669155
          comprehension 0.788457791
          fraction      86.01334371286879
          </code></pre>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>¬øB√∫cles o <i>Comprehensions</i>? (2/2)</h3>
        <div id="left">
        <pre style="font-size: 40%; width: 90%;"><code class="python" data-trim data-noescape>
        def f():
          r = []
          for i in range(N):
            if i % 2 == 0:
                r.append(i**3)
          return r

        def g():
          return [i**3
            for i in range(N) if i%2 == 0]
        </code></pre>
        </div>
        <div id="right">
          <pre style="font-size: 40%; width: 100%;"><code class="python fragment" data-trim data-noescape>
          loop          0.012062598
          comprehension 0.010817907
          fraction      89.681401966641
          </code></pre>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>¬øFunciones o no?</h3>
        <div id="left">
        <pre style="font-size: 40%; width: 90%;"><code class="python" data-trim data-noescape>
        def calculo(x, y):
            return 10**x + y

        def f():
            base = 2
            r = 0
            for i in range(1_000_000):
                r += calculo(base, i)
            return r

        def g():
            base = 2
            r = 0
            for i in range(1_000_000):
                r += 10**base + i
            return r
        </code></pre>
        </div>
        <div id="right">
          <pre style="font-size: 40%; width: 100%;"><code class="python fragment" data-trim data-noescape>
          funci√≥n   0.221610124
          operaci√≥n 0.18534425
          fraction  83.6352810307529
          </code></pre>
        </div>
      </section>


      <section data-transition="slide-in fade-out">
        <h3>Estructuras b√°sicas (1/3)</h3>
        Para cadenas:
        <p><i class="yellow">¬ømanipulaci√≥n de datos binarios?</i></p>
        <ul>
          <li class="fragment"><i class="green">s√≠</i>: <code>bytes</code></li>
          <li class="fragment"><i class="red">no</i>: <code>str</code></li>
        </ul>
          <pre style="font-size: 40%; width: 100%;"><code class="python fragment" data-trim data-noescape>
          >>> import sys
          >>> a = b"Hola"
          >>> b = "Hola"
          >>> sys.getsizeof(a)
          37
          >>> sys.getsizeof(b)
          53
          </code></pre>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>Estructuras b√°sicas (2/3)</h3>
        Para datos mutables:
        <p><i class="yellow">¬øson √∫nicos?</i></p>
        <ul>
          <li class="fragment"><i class="red">no</i>: <code>list</code></li>
          <li class="fragment"><i class="green">s√≠</i>: <code>set</code></li>
        </ul>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>Estructuras b√°sicas (3/3)</h3>
        Para datos <i class="red">no</i> mutables:
        <p><i class="yellow">¬øson √∫nicos?</i></p>
        <ul>
          <li class="fragment"><i class="red">no</i>: <code>tuple</code></li>
          <li class="fragment"><i class="green">s√≠</i>: <code>frozenset</code></li>
        </ul>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>¬øClases, Data clases, NamedTuple?</h3>
          <div id="left">
            <pre style="font-size: 40%; width: 90%;"><code class="python" data-trim data-noescape>
            class Persona1:
              def __init__(self, nombre, edad):
                self.nombre = nombre
                self.edad = edad
              # def __repr__(self) ¬øquiz√°s?
            </code></pre>
            <pre style="font-size: 40%; width: 90%;"><code class="python fragment" data-trim data-noescape>
            @dataclass
            class Persona2:
              nombre: str
              edad: int
            </code></pre>
          </div>
          <div id="right">
            <pre style="font-size: 40%; width: 90%;"><code class="python fragment" data-trim data-noescape>
            from collections import namedtuple

            Persona3 = namedtuple("Persona3",
                        ["nombre", "edad"])

            class Persona4(typing.NamedTuple):
              nombre: str
              edad: int
            </code></pre>

            <pre style="font-size: 40%; width: 90%;"><code class="bash fragment" data-trim data-noescape>
            Persona1 0.00014439
            Persona2 0.005883264
            Persona3 0.0001975
            Persona4 0.001248471
            </code></pre>

          </div>
      </section>


      <section data-transition="slide-in fade-out" data-background-color="rgb(52,103,146)">
        <h2>¬øNo es suficiente?</h2>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>Caching - <code>functools</code></h3>
        <p style="font-size: 80%;"><a href="https://docs.python.org/es/3/library/functools.html">docs.python.org/es/3/library/functools.html</a></p>
        <div id="left">
          <pre style="font-size: 40%; width: 90%;"><code class="python" data-trim data-noescape>
          import functools


          @functools.cache
          def factorial(n):
              return n * factorial(n-1) if n else 1

          # factorial(400): 0.00023379
          # factorial(400): 4.4e-07

          </code></pre>
        </div>
        <div id="right">
          <pre style="font-size: 40%; width: 90%;"><code class="python fragment" data-trim data-noescape>
          import functools


          @functools.lru_cache
          def factorial(n):
              return n * factorial(n-1) if n else 1

          # factorial(400): 0.00011717
          # factorial(400): 3e-07
          </code></pre>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>Cython</h3>
        <p style="font-size: 80%;"><a href="https://cython.readthedocs.io">https://cython.readthedocs.io</a></p>
        <div id="left">
          <pre style="font-size: 40%; width: 90%;"><code class="python" data-trim data-noescape>
          # fib.pyx
          def fib(n):
            """Print Fibonacci series up to n."""
            a, b = 0, 1
            while b < n:
                print(b, end=' ')
                a, b = b, a + b

            print()
          </code></pre>
        </div>
        <div id="right">
          <pre style="font-size: 40%; width: 90%;"><code class="python fragment" data-trim data-noescape>
          # setup.py
          from setuptools import setup
          from Cython.Build import cythonize

          setup(
              ext_modules=cythonize("fib.pyx"),
          )
          </code></pre>
          <pre style="font-size: 40%; width: 90%;"><code class="bash fragment" data-trim data-noescape>
          $ python setup.py build_ext --inplace
          </code></pre>
          <pre style="font-size: 30%; width: 90%;"><code class="python fragment" data-trim data-noescape>
          >>> import fib
          >>> fib.fib(2000)
          1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597
          </code></pre>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>Numba</h3>
        <p style="font-size: 80%;"><a href="https://numba.pydata.org">numba.pydata.org</a></p>
        <div id="left">
          <pre style="font-size: 40%; width: 90%;"><code class="python fragment" data-trim data-noescape>
          from numba import njit
          import random

          @njit
          def monte_carlo_pi(nsamples):
              acc = 0
              for i in range(nsamples):
                  x = random.random()
                  y = random.random()
                  if (x ** 2 + y ** 2) < 1.0:
                      acc += 1
              return 4.0 * acc / nsamples
          </code></pre>
        </div>
        <div id="right">
          <ul>
            <li class="fragment">Ejecutar operaciones en paralelo</li>
            <li class="fragment">Vectorizaci√≥n SIMD</li>
            <li class="fragment">Aceleraci√≥n con GPU</li>
          </ul>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>PyPy (1/2)</h3>
        <p style="font-size: 80%;"><a href="https://pypy.org">pypy.org</a></p>
        <div id="left">
          <ul>
            <li class="fragment">Reemplazo de CPython</li>
            <li class="fragment">No siempre las √∫ltimas versiones (3.9.15)</li>
            <li class="fragment"><i class="yellow">Escrito en Python</i> ü§Ø</li>
          </ul>
        </div>
        <div id="right">
          <pre style="font-size: 70%; width: 90%;"><code class="python fragment" data-trim data-noescape>
          # ...no hay c√≥digo
          # porque es...Python
          # ...
          # ¬øLo conoces no? :P
          </code></pre>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>PyPy (2/2)</h3>
        <p style="font-size: 80%;"><a href="https://pypy.org">pypy.org</a></p>
        <img style="width: 80%;" src="img/pypy_speed_graph.png"/>
      </section>

      <section data-transition="slide-in fade-out" data-background-color="rgb(216,44,29)">
        <h2>¬°No es suficiente!</h2>
      </section>

  <section data-transition="slide-in fade-out">
        <h3>Crea una extensi√≥n (1/3) - <i class="yellow">en C</i></h3>
    <p>simple.c</p>
    <pre class="fragment fade-in" data-fragment-index="1"style="font-size: 38%;width: 100%;"><code class="c" data-trim data-noescape>
    <span class="fragment" data-fragment-index="1">#include &lt;Python.h&gt;</span>
    <span class="fragment" data-fragment-index="2">static PyObject* simple_hola(PyObject* self, PyObject* args){
    <span class="fragment" data-fragment-index="2">    char *msg = "Holi :D";</span>
    <span class="fragment" data-fragment-index="2">    return Py_BuildValue("s", msg);</span>
    <span class="fragment" data-fragment-index="2">}</span>

    <span class="fragment" data-fragment-index="3">static char simple_docs[] = "hola(): imprime hola\n";</span>

    <span class="fragment" data-fragment-index="4">static PyMethodDef funciones[] = {</span>
    <span class="fragment" data-fragment-index="4">   {"hola",  (PyCFunction)simple_hola, METH_NOARGS, simple_docs},</span>
    <span class="fragment" data-fragment-index="4">   {NULL, NULL, NULL, NULL}</span>
    <span class="fragment" data-fragment-index="4">};</span>

    <span class="fragment" data-fragment-index="5">static struct PyModuleDef simplemodule = {</span>
    <span class="fragment" data-fragment-index="5">    PyModuleDef_HEAD_INIT, "simple", NULL, -1, funciones</span>
    <span class="fragment" data-fragment-index="5">};</span>

    <span class="fragment" data-fragment-index="6">PyMODINIT_FUNC PyInit_simple(void){</span>
    <span class="fragment" data-fragment-index="6">    return PyModule_Create(&amp;simplemodule);</span>
    <span class="fragment" data-fragment-index="6">}</span>
    </code></pre>
  </section>

  <section data-transition="slide-in fade-out">
        <h3>Crea una extensi√≥n (2/3) - <i class="yellow">en C</i></h3>
    <h3><i class="yellow">setup.py</i></h3>
    <pre class="fragment fade-in" data-fragment-index="1"style="font-size: 50%;width: 100%;"><code class="python fragment" data-trim data-noescape>
    from setuptools import setup, Extension

    setup(name='simple', version='1.0',
          ext_modules=[Extension('simple', ['simple.c'])])
    </code></pre>
    <h3><i class="yellow">pyproject.toml</i></h3>
    <pre class="fragment fade-in" data-fragment-index="1"style="font-size: 50%;width: 100%;"><code class="python fragment" data-trim data-noescape>
    [build-system]
    requires = ["setuptools"]
    build-backend = "setuptools.build_meta"
    </code></pre>
  </section>

  <section data-transition="slide-in fade-out">
        <h3>Crea una extensi√≥n (3/3) - <i class="yellow">en C</i></h3>
    <h3><i class="yellow">construir</i></h3>
    <pre class="fragment fade-in" data-fragment-index="1"style="font-size: 80%;width: 100%;"><code class="bash fragment" data-trim data-noescape>
    python -m build
    </code></pre>
  </section>

      <section data-transition="slide-in fade-out">
        <h3>Crea una extensi√≥n - <i class="yellow">en Rust</i></h3>
        <img src="img/rust.png">
        <p><a href="https://ohadravid.github.io/posts/2023-03-rusty-python/">ohadravid.github.io/posts/2023-03-rusty-python/</a></p>
      </section>


      <section data-transition="slide-in fade-out">
        <h3>Recomendaciones en m√≥dulos (1/4)</h3>
        <div id="left">
          <ul>
            <li class="fragment"><i class="yellow">Iterar archivos y directorios</i></li>
            <li class="fragment">¬ø<code>glob</code>?</li>
            <li class="fragment">¬ø<code>Pathlib.glob</code>?</li>
          </ul>
        </div>
        <div id="right">
        <pre class="fade-in" data-fragment-index="1"style="font-size: 50%;width: 100%;"><code class="bash fragment" data-trim data-noescape>
          Directories: 172246
          Files: 2360091

          # glob
          Non recursive: 0.01
          Recursive: 4.04

          # Pathlib.glob
          Non recursive: 0.41
          Recursive: 1.52

          # fastglob.glob
          Non recursive: 0.02
          Recursive: 0.33
        </code></pre>
        </div>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>Recomendaciones en m√≥dulos (2/4)</h3>
        <h4>std::filesystem::directory_iterator</h4>
        <img src="img/doc_fs.png" style="width: 80%;"/>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>Recomendaciones en m√≥dulos (3/4)</h3>
        <p><i class="yellow">numpy</i></p>
        <img src="img/numpy.png" style="width: 80%;"/>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>Recomendaciones en m√≥dulos (3/4)</h3>
        <p><i class="yellow">pandas</i></p>
        <ul>
          <li class="fragment"><code>.iterrows()</code> ‚Üí <code>.apply(lambda ... )</code> </li>
          <li class="fragment"><code>.iterrows()</code> ‚Üí <code>.itertuples()</code></li>
          <li class="fragment"><code>.isin()</code></li>
        </ul>
      </section>

      <section data-transition="slide-in fade-out" data-background-color="rgb(216,44,29)">
        <h2>¬°Necesito m√°s!</h2>
      </section>

      <section data-transition="slide-in fade-out">
        <h3>3.11 -  <i class="green">10-60% m√°s r√°pido</i> que 3.10</h3>
        <h2>3.12 - üìà</h2>
      </section>


      <section data-transition="slide-in fade-out" data-background-color="rgb(216,44,29)">
        <h2>¬øAplicaste todo esto y no te sirvi√≥ nada?</h2>
        <h2>üòí</h2>
      </section>

      <section data-transition="slide-in fade-out" data-background-color="rgb(0,170,127)">
        <h2>Quiz√°s es hora de utilizar otro lenguaje</h2>
        <h2>ü´†</h2>
      </section>

      <section data-background-image="img/cover.png">
        <div id="left70">
          <h2 style="font-size: 1.1em;">¬øPor qu√© <strike style="text-decoration-thickness: 6px;"><i class="ep-red">Python</i></strike> <i class="yellow">tu c√≥digo</i> es lento?</h2>
          <h4 style="font-size: 80%;"><i class="blue">recomendaciones para mejorar el rendimiento</i></h4>
        <p style="font-size: 70%;margin-top: 10%;">
          Dr. <i class="yellow">Cristi√°n</i> Maureira-Fredes
        </p>
        <p style="font-size: 50%">
          Senior R&amp;D Manager en  <img class="plain" src="img/qt.png" style="height: 50px; vertical-align: middle; background: rgba(0, 0, 0, 0);">
          <br/>
          @cmaureir<br/>
          <img class="plain" src="img/mastodon.png" style="background: rgba(0,0,0,0);height: 40px;">
          <img class="plain" src="img/github_white.png"  style="background: rgba(0,0,0,0);height: 40px;">
          <img class="plain" src="img/linkedin.png"  style="background: rgba(0,0,0,0);height: 40px;">
          <img class="plain" src="img/twitter.png" style="background: rgba(0,0,0,0);height: 40px;"><br/>
        </p>
        </div>
        <div id="right30">
        </div>
      </section>



      <!--***************************************************************************-->
    </div>
  </div>

  <script src="dist/reveal.js"></script>
  <script src="plugin/notes/notes.js"></script>
  <script src="plugin/markdown/markdown.js"></script>
  <script src="plugin/highlight/highlight.js"></script>
  <script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
      hash: true,
      transitionSpeed: 'fast',

      // Learn about plugins: https://revealjs.com/plugins/
      plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
    });
  </script>
  <!-- Hack to have a footer-->

  <!-- 1. Style header/footer <div> so they are positioned as desired: in css/qt.css -->
  <!-- 2. Create hidden header/footer <div> -->
  <div id="hidden" style="display:none;">
    <div id="header">
      <div id="header-left"></div>
      <div id="header-right"><img src="img/pythonchile_logo.png" style="width: 150px; margin-right: 20px;" /></div>
      <div id="footer-left"><p style="font-size: 18pt;margin-left: 20px;"><i class="yellow">Python Chile</i> | @cmaureir - https://maureira.xyz
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
  <script type="text/javascript">
    // 3. On Reveal.js ready event, copy header/footer <div> into each `.slide-background` <div>
    var header = $('#header').html();
    if ( window.location.search.match( /print-pdf/gi ) ) {
      Reveal.addEventListener( 'ready', function( event ) {
        $('.slide-background').append(header);
      });
    }
    else {
      $('div.reveal').append(header);
     }
  </script>
</body>
</html>
